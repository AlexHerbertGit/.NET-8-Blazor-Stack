@page "/dashboard"
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize]
@inject Web.Services.ApiClient Api
@inject NavigationManager Nav

<h3>Dashboard (/auth/me)</h3>

@if (loading)
{
    <p>Loading…</p>
}
else if (Me is null)
{
    <p>Not logged in.</p>
}
else
{
    <pre>@System.Text.Json.JsonSerializer.Serialize(Me, new System.Text.Json.JsonSerializerOptions { WriteIndented = true })</pre>
}

@code {
    MeDto? Me;
    bool loading = true;

    class MeDto { public string? id { get; set; } public string? email { get; set; } public string? role { get; set; } public int tokenBalance { get; set; } public string? name { get; set; } }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            Me = await Api.GetAsync<MeDto>("api/auth/me");
        }
        catch
        {
            // if your ApiClient throws on 401/JSON errors, you can redirect here
            Nav.NavigateTo("api/login");
        }
        finally
        {
            loading = false;
        }
    }
}